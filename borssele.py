#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
Created on Wed Dec  2 10:52:01 2020

@author: katdyk
"""

# Set up site conditions
from py_wake.site import UniformWeibullSite
from py_wake.site.shear import PowerShear
import numpy as np


def get_site():
    f = [0.051, 0.043, 0.043, 0.066, 0.089, 0.065,
            0.087, 0.115, 0.12, 0.111, 0.114, 0.096]
    A = [9.176929, 9.782334, 9.531809, 9.909545, 10.04269, 9.593921,
        9.584007, 10.51499, 11.39895, 11.68746, 11.63732, 10.08803]
    k = [2.11, 2.05, 2.35, 2.55, 2.81, 2.74,
        2.63, 2.40, 2.23, 2.28, 2.29, 2.28]
    ti = 0.11
    h_ref = 119
    alpha = .1
    site = UniformWeibullSite(f, A, k, ti, shear=PowerShear(h_ref=h_ref, alpha=alpha))

    site.boundary = np.array([[484178.55, 5732482.8], [500129.9, 5737534.4], [497318.1, 5731880.24], [488951.0, 5.72794e6], 
                              [488951.0, 5.72794e6], [497318.1, 5731880.24], [503163.37, 5729155.3], [501266.5, 5715990.05]])


    site.initial_position = np.array([[500968.1461, 5716452.78395],
                                        [499748.656451, 5717635.84752],
                                        [501245.774403, 5718427.21986],
                                        [500026.284754, 5719610.28343],
                                        [498527.828614, 5718809.39417],
                                        [497308.338965, 5719992.45774],
                                        [501523.402707, 5720401.65577],
                                        [500303.913058, 5721584.71934],
                                        [498805.456918, 5720783.83008],
                                        [497585.967269, 5721966.89364],
                                        [496087.511128, 5721166.00438],
                                        [494868.021479, 5722349.06795],
                                        [501801.03101, 5722376.09168],
                                        [500581.541361, 5723559.15524],
                                        [499083.085221, 5722758.26598],
                                        [497863.595572, 5723941.32955],
                                        [496365.139432, 5723140.44029],
                                        [495145.649783, 5724323.50386],
                                        [493647.193643, 5723522.6146],
                                        [492427.703994, 5724705.67817],
                                        [502078.659313, 5724350.52758],
                                        [500859.169664, 5725533.59115],
                                        [499360.713524, 5724732.70189],
                                        [498141.223875, 5725915.76546],
                                        [496642.767735, 5725114.8762],
                                        [495423.278086, 5726297.93977],
                                        [493924.821946, 5725497.05051],
                                        [492705.332297, 5726680.11408],
                                        [491206.876157, 5725879.22482],
                                        [489987.386508, 5727062.28839],
                                        [502356.287617, 5726324.96349],
                                        [501136.797968, 5727508.02706],
                                        [499638.341828, 5726707.1378],
                                        [498418.852179, 5727890.20137],
                                        [496920.396038, 5727089.31211],
                                        [495700.90639, 5728272.37568],
                                        [494202.450249, 5727471.48642],
                                        [492982.9606, 5728654.54999],
                                        [491484.50446, 5727853.66073],
                                        [490265.014811, 5729036.7243],
                                        [488766.558671, 5728235.83504],
                                        [487547.069022, 5729418.8986],
                                        [502633.91592, 5728299.3994],
                                        [501414.426271, 5729482.46297],
                                        [499915.970131, 5728681.57371],
                                        [498696.480482, 5729864.63728],
                                        [497198.024342, 5729063.74802],
                                        [495978.534693, 5730246.81159],
                                        [494480.078553, 5729445.92233],
                                        [493260.588904, 5730628.9859],
                                        [491762.132764, 5729828.09664],
                                        [490542.643115, 5731011.1602],
                                        [489044.186974, 5730210.27094],
                                        [487824.697325, 5731393.33451],
                                        [486326.241185, 5730592.44525],
                                        [485106.751536, 5731775.50882],
                                        [497475.652645, 5731038.18393],
                                        [496256.162996, 5732221.2475],
                                        [494757.706856, 5731420.35824],
                                        [493538.217207, 5732603.4218],
                                        [492039.761067, 5731802.53254],
                                        [490820.271418, 5732985.59611],
                                        [489321.815278, 5732184.70685],
                                        [488102.325629, 5733367.77042],
                                        [486603.869489, 5732566.88116],
                                        [497753.280949, 5733012.61984],
                                        [496533.7913, 5734195.6834],
                                        [495035.335159, 5733394.79414],
                                        [493815.845511, 5734577.85771],
                                        [492317.38937, 5733776.96845],
                                        [489599.443581, 5734159.14276],
                                        [498030.909252, 5734987.05574],
                                        [496811.419603, 5736170.11931],
                                        [495312.963463, 5735369.23005]])


    return site


# Set up IEA Wind 10 MW Reference Turbine
from py_wake.wind_turbines import OneTypeWindTurbines
rated_power = 10000. #kW
power_curve = np.array([[4, 0.0417775416641181 * rated_power], 
                        [5, 0.100966625080239 * rated_power], 
                        [6, 0.184703860860372 * rated_power], 
                        [7, 0.29363066617047 * rated_power], 
                        [8, 0.437408914882465 * rated_power], 
                        [9, 0.619863166839864 * rated_power], 
                        [9.5, 0.722289307327511 * rated_power], 
                        [10, 0.830738083625031 * rated_power], 
                        [10.5, 0.945267874693394 * rated_power], 
                        [11, rated_power], 
                        [11.5, rated_power], 
                        [12, rated_power], 
                        [13, rated_power], 
                        [14, rated_power], 
                        [15, rated_power], 
                        [16, rated_power], 
                        [18, rated_power], 
                        [20, rated_power], 
                        [25, rated_power]])

ct_curve = np.array([[4, 0.927057057803911], 
                    [5, 0.92026094738932], 
                    [6, 0.874953044625167], 
                    [7, 0.85837496336839], 
                    [8, 0.841138019072282], 
                    [9, 0.79462070404387], 
                    [9.5, 0.75889164978347], 
                    [10, 0.725733585868264], 
                    [10.5, 0.694978605245016], 
                    [11, 0.597310898042545], 
                    [11.5, 0.493702775004447], 
                    [12, 0.420621597422679], 
                    [13, 0.319501163417707], 
                    [14, 0.251839216314048], 
                    [15, 0.203566086419764], 
                    [16, 0.167756545404188], 
                    [18, 0.119172464082921], 
                    [20, 0.0886910505776589], 
                    [25, 0.0489237513003403]])


class IEA10MW(OneTypeWindTurbines):
    '''
    Data from:
    Christian Bak, Frederik Zahle, Robert Bitsche, Taeseong Kim, Anders Yde, Lars Christian Henriksen, Anand Natarajan,
    Morten Hartvig Hansen.“Description of the DTU 10 MW Reference Wind Turbine” DTU Wind Energy Report-I-0092, July 2013. Table 3.5

    '''

    def __init__(self):
        OneTypeWindTurbines.__init__(
            self,
            'DTU10MW',
            diameter=190.6,
            hub_height=119.,
            ct_func=self._ct,
            power_func=self._power,
            power_unit='kW')

    def _ct(self, u):
        return np.interp(u, ct_curve[:, 0], ct_curve[:, 1])

    def _power(self, u):
        return np.interp(u, power_curve[:, 0], power_curve[:, 1])


IEA10WM_RWT = IEA10MW


def main():
    wt = DTU10MW()
    print('Diameter', wt.diameter())
    print('Hub height', wt.hub_height())
    ws = np.arange(3, 25)
    import matplotlib.pyplot as plt
    plt.plot(ws, wt.power(ws), '.-')
    plt.show()


if __name__ == '__main__':
    main()
